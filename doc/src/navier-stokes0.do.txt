# Stand-alone notebook?
# #if FORMAT == "ipynb"
# #include "mako_code.txt"
# #endif

======= The Navier--Stokes equations =======

As our final example in this chapter, we will solve the incompressible
Navier-Stokes equations. This problem combines many of the challenges
from our previously studied problems: time-dependence, nonlinearity,
and vector-valued variables.

===== PDE problem =====

The incompressible Navier-Stokes equations are a system of equations
for the velocity $u$ and pressure $p$ in an incompressible fluid:

!bt
\begin{align}
  label{ftut1:ns:momentum}
  \dot{u} + u \cdot \nabla u - \nabla\cdot\sigma(u, p) &= f, \\
  label{ftut1:ns:continuity}
  \nabla \cdot u &= 0.
\end{align}
!et
The right-hand side $f$ is a given force per unit volume and
just as for the equations of linear elasticity,
$\sigma(u, p)$ denotes the stress tensor which for a Newtonian fluid
is given by

!bt
\begin{equation}
  \sigma(u, p) = 2\nu\epsilon(u) - pI.
\end{equation}
!et
The parameter $\nu$ is the kinematic viscocity.

===== Variational formulation =====

The Navier--Stokes equations are different from
the time-dependent heat equation in that we need to solve a system of
equations and this system is of a special type. If we apply the same
technique as for the heat equation; that is, replacing the time
derivative with a simple difference quotient, we face two
challenges. First, we obtain a nonlinear system of equations. This in
itself is not a problem for FEniCS as we saw in Section
ref{ftut1:gallery:nonlinearpoisson}, but the system has a so-called
*saddle point structure* and requires special techniques
(preconditioners and iterative methods) to be solved efficiently.

Instead, we will apply a simpler and often very efficient approach
which is to use a *splitting method*. In a splitting method, we
consider the two equations (ref{ftut1:ns:momentum}) and
(ref{ftut1:ns:continuity}) separately. There exist many splitting
strategies for the incompressible Navier-Stokes equations. One of the
oldest is the method proposed by Chorin cite{Chorin1968} and
Temam cite{Temam1969}, often refered to as Chorin's method. We will
use a modified version of Chorin's method, the so-called incremental
pressure correction scheme (IPCS) due to cite{Goda1979} which gives
improved accuracy compared to the original scheme at little extra
cost.

The IPCS scheme involves three steps. First, we compute a *tentative
velocotity* $u^{\bigstar}$ by advancing the momentum equation
(ref{ftut1:ns:momentum}) using the pressure $p^{n-1}$ from the previous time
interval. The variational problem for this first step is:

[AL: I am here.]

!bt
  \begin{multline}\label{eq:ipcs,1}
      \renni{v}{(u^{\bigstar} - u^{n-1}) / \dt}
      + \renni{v}{u^{n-1} \cdot \nabla u^{n-1}}
      + \renni{\epsilon(v)}{\sigma(u^{n-\frac{1}{2}}, p^{n-1})}
      \\
      + \renni{v}{p^{n-1} n}_{\partial\Omega}
      - \renni{v}{\nu n \cdot (\nabla u^{n-\frac{1}{2}})^{\top}}_{\partial\Omega}
      = \renni{v}{f^n}
  \end{multline}
!et
This notation requires some explanation.

!bwarning
grad vs nabla grad!
!ewarning

Test

!bt
\begin{align}
  \langle (u_h^{\star} - u_h^{n-1}) / \Delta t_n, v \rangle +
  \langle \nabla u_h^{n-1} \cdot u_h^{n-1}, v \rangle +
  \langle \nu \nabla u_h^{\star}, \nabla v \rangle =
  \langle f, v \rangle.
\end{align}
!et

===== A simple implementation =====
